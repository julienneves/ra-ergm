% Class Notes Template
\documentclass[12pt]{article}
\usepackage[margin=1in]{geometry}
\usepackage[utf8]{inputenc}

% Packages
\usepackage[french, english]{babel}
\usepackage{amsmath, amsthm, amssymb ,amsfonts, graphics, tikz, float, enumerate}
\usepackage{listings}
\usepackage{color} %red, green, blue, yellow, cyan, magenta, black, white
\definecolor{mygreen}{RGB}{28,172,0} % color values Red, Green, Blue
\definecolor{mylilas}{RGB}{170,55,241}

\lstset{language=Matlab,%
	%basicstyle=\color{red},
	breaklines=true,%
	morekeywords={matlab2tikz},
	keywordstyle=\color{blue},%
	morekeywords=[2]{1}, keywordstyle=[2]{\color{black}},
	identifierstyle=\color{black},%
	stringstyle=\color{mylilas},
	commentstyle=\color{mygreen},%
	showstringspaces=false,%without this there will be a symbol in the places where there is a space
	numbers=left,%
	numberstyle={\tiny \color{black}},% size of the numbers
	numbersep=9pt, % this defines how far the numbers are from the text
	emph=[1]{for,end,break},emphstyle=[1]\color{blue}, %some words to emphasise
	%emph=[2]{word1,word2}, emphstyle=[2]{style},
}

% Title
\title{ERGM and SAR}
\date{\today}
\author{Julien Manuel Neves}

% Use these for theorems, lemmas, proofs, etc.
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{observation}[theorem]{Observation}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{fact}[theorem]{Fact}
\newtheorem{assumption}[theorem]{Assumption}
\newtheorem{problem}[theorem]{Problem}
\newtheorem{set-up}[theorem]{Set-up}
\newtheorem{example}[theorem]{Example}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{axiom}[theorem]{Axiom}

% Usefuls Macros
\newcommand{\field}[1]{\mathbb{#1}}
\newcommand{\N}{\field{N}} % natural numbers
\newcommand{\R}{\field{R}} % real numbers
\newcommand{\Z}{\field{Z}} % integers
\newcommand\F{\mathcal{F}}
\newcommand\B{\mathbb{B}}
\renewcommand{\Re}{\R} % reals
\newcommand{\Rn}[1]{\mathbb{R}^{#1}}
\newcommand{\1}{{\bf 1}} % vector of all 1's
\newcommand{\I}[1]{\mathbb{I}_{\left\{#1\right\}}} % indicator function
\newcommand{\La}{\mathscr{L}}
% \newcommand{\tends}{{\rightarrow}} % arrow for limits
% \newcommand{\ra}{{\rightarrow}} % abbreviation for right arrow
% \newcommand{\subjectto}{\mbox{\rm subject to}} % subject to

%% math operators
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\maximize}{maximize}
\DeclareMathOperator*{\minimize}{minimize}
\DeclareMathOperator{\E}{\mathbb{E}} % expectation
\newcommand{\Ex}[1]{\E\left\{#1\right\}} % expectation with brackets
\DeclareMathOperator{\pr}{\mathbb{P}} % probability
\newcommand{\prob}[1]{\pr\left( #1 \right)}
\DeclareMathOperator{\subjectto}{{s.t.\ }} % subject to
\newcommand{\norm}[1]{\left\|#1\right\|}
\newcommand{\card}[1]{\left|#1\right|}

% Extra stuff
\newcommand\seq[1]{\{ #1 \}}
\newcommand{\inp}[2]{\langle #1, #2 \rangle}

\newcommand{\inv}{^{-1}}

\newcommand{\pa}[1]{\left(#1\right)}
\newcommand{\bra}[1]{\left[#1\right]}
\newcommand{\cbra}[1]{\left\{ #1 \right\}}

\newcommand{\pfrac}[2]{\pa{\frac{#1}{#2}}}
\newcommand{\bfrac}[2]{\bra{\frac{#1}{#2}}}

\newcommand{\mat}[1]{\begin{matrix}#1\end{matrix}}
\newcommand{\pmat}[1]{\pa{\mat{#1}}}
\newcommand{\bmat}[1]{\bra{\mat{#1}}}

\begin{document}

\maketitle

\section*{Model}

Let $G$ be the observed network and assume it is derived from the following distribution
\[P(G = g \mid \theta,\phi) = \frac{\exp\cbra{\theta^Ts(g) + \phi \xi}}{c(\theta,\phi)}\]
where $\xi$ is some vector of unobservables characteristics for the agents and $s(y)$ a vector of statistics for the network.

Let's assume that we are trying to estimate the following model
\[
	Y  = \lambda G Y + X\beta + \underbrace{\psi \xi + \nu}_{\epsilon}
\]
where $\nu\sim N(0,\sigma_\nu^2)$.

The issue we face is that $G$ is obviously endogenous and therefore we can't use the following moment conditions:
\[
\Ex{H'\epsilon(\lambda,\beta,\psi)} = 0
\]
where $H = \cbra{X, GX, G^2X, \dots}$.

\section*{Estimation}
To solve the endogeneity problem, first we need to fit an Exponential Random Graph Model (ERGM) using our $G$ and MCMC. This should yields some, hopefully consistent, sample estimates $\hat{\theta}$ and $\hat{\xi}$.

Using these estimates, let's define the following ERGM
\[P(\tilde{G} = g \mid \theta,\phi) = \frac{\exp\cbra{\hat{\theta}^Ts(g)}}{c(\theta,\phi)}\]

Let $\tilde{G}$ be some realization of the previous distribution. Since $\tilde{G}$ should technically get rid of $\xi$, do we expect that the following holds
\[
\Ex{\Ex{\tilde{H}'\epsilon(\lambda,\beta,\psi)\mid \tilde{G}}} = 0
\]
where $H = \cbra{X, \tilde{G}X, \tilde{G}^2X, \dots}$? If so, can't we simply to use NLLS without having to do any method of simulated moments?

If instead, we are assuming that there is some function $\pi(\theta)$, that might not be known, such that
\[
\Ex{\Ex{\tilde{H}'\epsilon(\lambda,\beta,\psi)\mid \tilde{G}}} = \pi(\theta)
\]
Then, how do we generate $\epsilon(\lambda,\beta,\psi)$ without observing $\xi$? What kind of distributional assumption would we make for $\epsilon$?



\end{document}
